# Бот для Новокольцово
Сейчас в Новокольцово ближайший магазин продуктов находится очень далеко от студенческих общежитий. Если у студента внезапно закончился хлеб, то ему нужно будет потратить минимим 40 минут, чтобы его получить. Было бы славно, если бы студент знал, кто из жильцов кампуса уже сейчас находится в магазине и может купить хлеб или собирается идти за покупками в ближайшее время.
Бот будет предоставлять эту информацию, храня информацию о тех студентах (заказчиках), которым нужны какие-то продукты и тех студентах(доставщиках), которые уже находится в магазине и готовы помочь заказчикам, взяв и необходимые заказчикам продукты. Так будет экономится суммарное время на походы в магазин у студентов.
Ближайшие задачи

2. Работа с заказчиками. Создание, изменение, отмена заказа.
3. Работа с доставщиками. Просмотр доступных заказов, принятие заказа, завершение заказа, связь заказчика с доставщиком. 
4. Регистрация пользователей. Вход пользоватетеля в систему из разных платформ.
Общение между заказчиком и доставщиком, вошедших в систему из разных платформ.
5. Рейтинг доставщиков, формируемый заказчиками.


### Задача 5 (Рейтинг пользователей)

#### формулировка

Дать пользователям возможность оценивать поведение друг друга в программе: заказчикам - качество предоставленных курьером услуг. Курьеру - адекватность заказчика.

Для этого после завершения заказа, курьер и заказчик будут оценивать друг друга по пятибальной шкале после завершения заказа.

Рейтинг пользователя - среднее арифметическое всех оценок.

Для того, чтобы по рейтингу курьера (если он низкий) заказчик мог изменить свое поведение, добавить возможность отмены заказа заказчиком.

Выводить рейтинг пользователя курьеру и заказчику, когда первый делает выбор, браться ли за заказ, второй видит, кто его заказ принял.

Отображать рейтинг пользователя в меню его профиля.

  

Также:

-   развернуть проект на сервере, где он будет работать
    
-   Добавить кнопки для главного меню в телеграме
    

#### Примеры

Рассмотрим жизненный цикл заказа (если тот отменили до завершения):

##### Со стороны Курьера:

…

К: /accept_order  
Б: Введите номер заказа, который хотите принять.  
К: 14  
Б: Заказ номер 14  
Создан: adfips  
Описание заказчика: Ради одних я пойду на край света, ради других даже в подъезд не выскочу
Рейтинг заказчика: 4.1  
Описание заказа: Молочный чай улун  
Введите еще раз номер заказа, для подтверждения принятия заказа.Либо команду /cancel для выхода из контекста принятия заказа.  
К: 14  
Б: Заказ принят. Контакты для связи с заказчиком:  
TELEGRAM: @adfips  
VK: id391326402  
 
##### Со стороны Заказчика:  
Б: Ваш заказ (14) “молочный чай улун” принят и выполняется:  
Курьер: fenya  
Описание курьера: Упадешь телом - поднимут, упадешь духом - затопчут.  
Рейтинг курьера: 1.0  
З: /cancel_order  
Б: Введите номер заказа, который хотите отменить  
З: 14  
Б: Заказ отменен.  
Со стороны Курьера:  
Б: Заказ 14 “Молочный чай улун” отменен заказчиком.  

#### Рассмотрим весь жизненный цикл заказа (если тот дошел до завершения):

##### Со стороны Курьера:  
…
К: /accept_order  
Б: Введите номер заказа, который хотите принять.  
К: 14  
Б: Заказ номер 14  
Создан: adfips  
Описание заказчика: Ради одних я пойду на край света, ради других даже в падик не выскочу  
Рейтинг заказчика: 4.1  
Описание заказа: Молочный чай улун  
Введите еще раз номер заказа, для подтверждения принятия заказа.Либо команду /cancel для выхода из контекста принятия заказа.  
К: 14  
Б: Заказ принят. Контакты для связи с заказчиком:  
TELEGRAM: @adfips  
VK: id391326402  

##### Со стороны Заказчика:  
Б: Ваш заказ (14) “молочный чай улун” принят и выполняется:  
Курьер: fenya  
Описание курьера: Упадешь телом - поднимут, упадешь духом - затопчут.  
Рейтинг курьера: 1.0  
Со стороны Курьера:  
К: /close_order  
Б: выберите заказ, который хотите завершить (14).  
К: 14  
Б: Готово! Ожидайте подтверждения заказчика.  
Б: Оцените адекватность заказчика числом от 1 до 5, где 1 - все плохо, 5 - все замечательно.  
К: 2  
Б: Готово!  
Б: Ваш заказ “Молочный чай улун” доставлен. Подтвердите получение заказа. Напишите yes , если заказ принят и no, Если нет.  
П: yes  
Б: Готово! Оцените услуги курьера числом от 1 до 5, где 1 - все плохо, 5 - все замечательно.  
П: 4  
Б: Готово!  
#### Просмотр рейтинга пользователя в меню Пользователя:
П: /profile  
Б: Напишите:  
/show_profile, чтобы посмотреть, как выглядит ваш профиль.  
/edit_login, чтобы изменить логин  
/edit_username , чтобы изменить имя пользователя.  
/edit_description, чтобы изменить описание к вашему аккаунту.  
/done для выхода.  
П: /show_profile  
Б: Ваш профиль:  
Логин: login1700246522966  
Имя: User   
Описание: Я есть user  
Рейтинг: 3.25  
П: /done  
Б: готово  

### Задача 4 (Регистрация на другой платформе, взаимодействие пользователей на разных платформах)
Реализовать регистрацию и вход в систему через другую платформу (в случае, если пользователь уже зарегистрирован) с помощью команд /register и /login соответственно.
Реализовать взаимодействие пользователей на разных платформах. Выводить информацию о заказчике, когда курьер намерен принять его заказ, и выводить информацию о курьере заказчику, когда заказ принят курьером.

Замечание 1: При отправке команды боту пользователем, ответ на нее приходит на ту же платформу, с которой пользователь отправил эту команду

Замечание 2:
Уведомление, что заказ принят будет отправлено на все платформы, с которых авторизован заказчик.

Детали реализации: В базе данных создается новая таблица loggin_users c столбцами:

loginContext - целое число отвечающее за номер этапа авторизации пользователя

required_login - логин, под которым хочет зайти пользователь
fromPlatform - платформа, через которую хочет зайти пользователь

id_on_platform - id пользователя на платформе, с которой хочет зайти пользователь

verification_platform - платформа, на которую должен отправиться код подтверждения для входа

verification_code - Код подтверждения, отправляемый на указанную пользователем платформу

Алгоритм:

Пользователь вводит /login, Во время обработки, программа понимает, что записи в таблице зарегистрированных пользователей logged_users нет. Поэтому она создает (если ее нет) запись в новой таблице вида: <br>
login_context: 0 <br>
required_login: default_login(null) <br>
from_platforn: <платформа, с которой написал пользователь> <br>
id_on_platform: <идентификатор пользователя на платформе, с которой он пишет> <br>
verification_platform: NO_PLATFORM <br>
verification_code: 0 <br>

Затем меняя номер контекста таблица заполняется. Нужная запись находится по столбцам from_platform и id_on_platform.

После того, как последнее сообщение отправлено, на указанную в столбце verification_platform платформу приходит сообщение пользователю с указанным в столбце required_login логином.

Пользователь вводит пришедший код. Если они совпадают, создается новая запись в таблице logged_users с id, найденным по логину, platform, скопированной из столбца from_platform и id_on_platform, скопированный из столбца новой таблицы id_on_platform. После запись удаляется из новой таблицы.
### Примеры:
/register П - пользователь, Б - бот: <br>
П: /start <br>
Б: Привет! Чтобы начать работу, авторизуйся отправив /login или зарегистрируйся как новый пользователь, отправив /register <br>
П: /register <br>
Б: Готово! Аккаунт создан. <br>
Вы находитесь в меню редактирования пользователя. <br>
Введитете /help для справки. <br>
П: /show_profile <br>
Б: <информация о пользователе> <br>
П: /done <br>
Б: Изменения сохранены. <Пользователь выходит из контекста> <br>
/login П - пользователь, Б - бот: <br>
П: /start <br>
Б: Привет! Чтобы начать работу, авторизуйся отправив /login или зарегистрируйся как новый пользователь, отправив /register <br>
П: /login <br>
Б: Введите логин. <br>
П: mafioznik <br>
Б: Введите платформу, на которую будет отправлен код подтверждения для входа. <br>
П: telegram <br>
Б: Введите код подтверждения, отправленный в через бот на указанную платформу. <br>
П: 1812 <br>
Б: Авторизация прошла успешно. <br>

Д - доставщик, Б - бот: <br>

Д: /accept_order <br>
Б: Введите номер заказа, который хотите принять. <br>
Д: 2016 <br>
Б: Заказ номер 2016 <br>
Создан: mafioznik <br>
Описание: куриный дошик (квисти) <br>
Принять заказ? /yes /no ? <br>
Д: /yes <br>
Б: Готово. Заказ выполняется. Для дополнительной информации свяжитесь с заказчиком через: <br>
Telegram: @fenya00 <br>
Vk: 2dim_mbi4 <br>

<В это время> <br>

З - заказчик, Б - бот <br>
Б: Курьер kamenshik, rabotaet_tri_dnya <br>
Взялся за выполнение вашего заказа. <br>
<описание заказа> <br>
Для уточнения деталей заказа свяжитесь в курьером через: <br>
Telegram: @adfips <br>

<В это время> <br>
Д - доставщик, Б - бот: <br>
Б: заказчик принял вашу помощь. Для связи с ним пишите @adfips в telegram <br>
(платформа). <br>


### Задача 3 (Работа с доставщиками)
Дать доставщику возможность посмотреть заказы (в состоянии PENDING),
принимать заказы, которые он намерен доставить заказчику c помощью соответсвующих команд.
Если заказ принят доставщиком, оповестить заказчика об этом, отправив сообщение.
После того, как заказ был доставлен,
доставщик начинает процедуру завершения заказа.
Заказчик подтверждает завершение заказа и завершает процедуру завершения заказа.

### команды (telegram)
```
/accept_order
/show_pending_orders
/close_order
/show_pending_orders
/show_accept_order
```

Пример взаимодействия с ботом: <b>Д</b> - доставщик, <b>Б</b> - бот, <b>З</b> - заказчик.

```
Д: /show_pending_orders
Б: 	123: “хороший борщик, с капусткой, но не красный.”
451: “Сосисочки, непонятный салат.”
814: “Яблоки с ананасами.”
915: “Вкусный чай.”
Д: /accept_order
Б: Выберите номер заказа, который хотитет принять.
П: 814
Б: заказ принят. < перешел в состояние RUNNING >

~~~~ Спустя некоторое время ~~~~

П: /close_order
Б: выберите заказ, который хотите завершить (814).
П: 814
Б: Готово! Ожидайте подтверждения заказчика. < Заказ переходит в состояние CLOSING >

~~~~ В это время ~~~~
Б: Ваш заказ “Яблоки с ананасами.” был принят и сейчас доставляется.
Б: Ваш заказ  “Яблоки с ананасами.” доставлен. Подтвердите получение заказа. Напишите /yes , если заказ принят и /no, Если нет.
П: /yes
Б: Готово! <Заказ переходит в состояние CLOSED, если no - NOT_CLOSED>
```

 + Поменяем логику обработки сообщений


### Задача 2
Дать заказчику возможность создать заказ, изменить его, отменить, просмотреть свои сделанные заказы с помощью соответствующих команд.

```
/create_order
/edit_order (mb /update_order)
/cancel_order
/show_orders (mb /show_my_orders)
```

Пример взаимодействия с ботом (телеграм) <b>П</b> - пользователь, <b>Б</b> - бот:
Cоздание, просмотр, изменение, удаление заказа.<br>

```
   П: /create_order
   Б: Перечислите, что вам нужно.
   П: Хлеб, молоко, гречка.
   Б: Готово! Заказ добавлен в список ваших заказов.
   П: /edit_order
   Б: выберите заказ, который хотите изменить.
   П: нажимает кнопку / отправляет номер заказа.
   Б: Перечислите, что вам нужно.
   П: картофель, лук.
   Б: Готово! Заказ добавлен в список ваших заказов.
   П: /show_my_orders
   Б: *Выводит список заказов с их описанием*.
   П: /cancel_order
   Б: Выберите заказ, который хотите удалить
   П: нажимает кнопку / отправляет номер заказа.
   Б: готово! Заказ удален.
```